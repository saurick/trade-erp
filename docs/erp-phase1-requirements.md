# ERP 第一期预需求实现清单（2026-02-10）

> 依据 `ExportSalesOpsSystem_Detail_v2.xlsx`、流程文档与合同附件整理。

## 已实现范围

### 业务链路与模块

- 客户/供应商 → 产品 → 报价单 → 外销 → 采购合同 → 入库通知/检验/入库 → 库存 → 出运明细 → 出库 → 结汇 → 水单认领 → 认领确认
- 全链路状态箱：草稿箱 / 待批箱 / 已批箱 / 招领箱 / 确认箱 / 免批

### 关键联动

- 报价单 → 外销（生成）
- 外销 → 采购合同 / 出运明细（生成）
- 采购合同 → 入库通知（生成）
- 入库通知 → 允许入库（生成入库单 + 库存增加）
- 出运明细 → 出库（生成 + 库存扣减）
- 出运明细 → 结汇（生成 + 预计收汇日期自动计算）
- 水单 → 认领确认（状态转确认箱）

### 打印模板

- 报价单、PI、采购合同、商业发票、装箱单、送货单、生产加工申请单
- 开票信息模板（来源：`杭州科森磁材开票信息.pdf`）
- 模板字段覆盖来源文档的主要字段（客户、运输条款、付款方式、品名、数量、金额、唛头等）
- 打印中心支持上传原始 `.xls/.xlsx` 模板并覆盖使用
- 打印弹窗内 Excel 模板单元格支持全编辑后再打印；开票信息模板左右字段双向同步，右侧文字可编辑（logo/水印除外，不支持上传覆盖）

### 登录与权限（新增）

- ERP 管理后台新增管理员登录页：`/admin-login`
- 未登录访问时静默跳转登录页，不再弹“未登录”提示 toast
- 角色：超级管理员（`level=0`）与普通管理员（一级/二级）
- 菜单权限：仅控制菜单显示，不限制接口数据返回
- 权限管理页：`/system/permissions`，仅超级管理员可修改其他管理员的菜单权限
- Logo：登录页使用 `KS MAGNETICS` SVG 资源

### 后端 CRUD（新增）

- 所有 ERP 模块改为后端持久化 CRUD（`erp` JSON-RPC 域）
- 统一数据表：`erp_module_records`
- 前端模块页已接入后端 `list/create/update/delete`
- 前端已移除模块 seed 演示数据，仅展示后端真实数据
- 服务端已增加模块级规则校验（模块白名单、必填字段、数值范围、状态箱合法值）
- 服务端已统一计算关键派生字段（`totalAmount`、`totalPackages`、`receivableDate`）

## 仍待下一阶段（可选）

- 其余未提供原始文件的模板需继续补齐并上传，以实现逐模板 1:1 对齐
- 导入/导出 Excel（附件上传已支持，导入导出仍待补齐）
- 业务模块细粒度权限（当前仅菜单显示权限）
