# `erp_module_records` 单表可行性评估（2026-02-11）

## 结论

`erp_module_records` **可以支撑当前 Phase 1 的统一 CRUD 与菜单联调**，但**不能长期覆盖 ERP 的全部需求**。

建议定位：

- 短期：继续作为“模块通用记录池”支撑快速迭代。
- 中长期：对关键链路逐步拆分专表（库存流水、结汇/回款、审批流、主数据字典等）。

## 当前能覆盖的点

- 11 个模块统一 `list/create/update/delete`
- 模块白名单、必填字段、数值范围、状态箱校验
- 关键派生字段（`totalAmount`、`totalPackages`、`receivableDate`）
- 菜单级联调与打印中心取数

## 单表的主要瓶颈

- 关系完整性弱：跨模块依赖（如出运->出库->结汇）缺少外键约束，脏数据难在 DB 层阻断。
- 查询与统计成本高：核心字段在 `payload(JSON)`，复杂筛选/报表依赖 JSON 解析，性能与索引能力受限。
- 业务约束下沉不足：唯一性、状态迁移、库存守恒等规则难以用数据库约束强保证。
- 并发一致性风险：库存增减、链路联动主要在应用层处理，缺少事务化专表模型。
- 可维护性下降：字段演进和历史兼容逻辑会持续堆积在应用代码。

## 建议的演进方向

- 第一优先级拆表：`inventory_movements`（库存流水）与 `settlement_receipts`（回款明细）。
- 第二优先级拆表：`workflow_tasks`（审批节点与操作日志）。
- 主数据抽离：客户/供应商/产品字典从 `payload` 迁出，补充唯一索引与外键。
- 保留 `erp_module_records` 作为“扩展字段层”或“过渡层”，逐模块迁移。

## 本次联调保障

已补充批量测试数据工具（见 `docs/erp-testdata.md`），支持按前缀随时造数与撤销，确保前端菜单联调基于真实数据库数据。
